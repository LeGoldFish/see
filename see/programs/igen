-- igen <classArchive> <mainClass>
local _, err = pcall(function(...)
    local config = { }
    local fileHandle = fs.open("/.see", "r")
    local configFunc = loadstring(fileHandle.readAll())
    setfenv(configFunc, config)
    configFunc()
    fileHandle.close()

    os.loadAPI(fs.combine(config.install_dir, "apis/see"))

    local args = { ... }
    local classPath = "/" .. shell.resolve(args[1])
    local mainClass = args[2]

    local archiveHandle = fs.open(classArchive, "r")
    local archiveBytes = archiveHandle.readAll()
    archiveHandle.close()

    local code = 'shell.run(' .. fs.combine(config.install_dir, "programs/see") .. ', "-r", ' .. classPath .. ', ' .. mainClass .. ')'
end, ...)

os.unloadAPI(fs.combine(config.install_dir, "apis/see"))

if err then
    error(err)
end